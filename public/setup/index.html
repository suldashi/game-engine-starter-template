<!doctype html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="../style.css">
</head>
<body>
	<div id="root"></div>
	<article>
		<h1>Lesson 0 - Intro</h1>
		<h3>In this article we will be setting up the infrastructure to build the JavaScript file that will be served to the players, the main game loop, and the capability to draw things on the screen.</h3>
		<h4>Setting up the tools</h4>
		<p>
			In a web browser context, all JavaScript code that needs to be executed by the end user must ultimately be served through a <code>&lt;script&gt; tag.</code>
			While making our game, eventually we will have to split our code into multiple files, and it's not viable to use <code>script</code> tags for each of them.
			This makes it necessary to have a build (or bundling) step, where all of our small JavaScript files are merged into a single file, which is then served to our players.
		</p>
		<p>
			We'll be using <a href="http://browserify.org/">Browserify</a> and <a href="https://gulpjs.com/">Gulp</a> to do the code bundling.
			These programs run in a <a href="https://nodejs.org">Node.js</a> context, so we'll need to install Node.js to use Browserify and Gulp.
			After installing Node.js and initializing a project, we install Browserify and Gulp using the following command: <code class="codeblock">npm install --save-dev gulp browserify vinyl-source-stream vinyl-buffer</code>
			Also, we'll need to install Gulp globally in our system using the following command: <code class="codeblock">npm install -g gulp-cli</code>
			You may have noticed that we added <code>vinyl-buffer</code> and <code>vinyl-source-stream</code> in our installation. They are used by Browserify to manipulate files and streams.
		</p>
		<p>
			We'll also need a web server to host the game. 
			<a href="https://expressjs.com/">Express</a> is by far the most popular Node.js web server, so we'll install that by running the following command: <code class="codeblock">npm install --save express</code>
		</p>
		<p>
			We'll place the game source code in the <code>src</code> directory. The entry point of the game will be the <code>engine.js</code> file, and it servers a similar role to <code>main()</code> function in C++, Java, and C#.
			We'll create the <code>engine.js</code> file, place it in the <code>src</code> directory, and put the following code there: <code class="codeblock">console.log("hello game");</code>
		</p>
		<h4>Project directory structure</h4>
		<p>
			Our project has three primary directories: <code>app</code>, <code>public</code>, and <code>src</code>. We'll need to create them all.
		</p>
		<p>
			The <code>app</code> directory is used to host the Node.js web server that will serve our HTML and JS files during development.
			In the <code>app</code> directory, we'll create a file, <code>index.js</code>, and place the following code there:
			<pre class="codeblock">
const express = require('express');
const app = express();
const server = require('http').createServer(app);
const path = require('path');

const port = 8080;

app.use('/public', express.static(path.resolve(__dirname,'..','public')));

app.get('/', (req,res) => {
	res.redirect('/public');
});

server.listen(port);
console.log('started on ' + port);
			</pre>
		</p>
		<p>
			The <code>public</code> directory is used to host the files that will be served by the web server.
			Let's create an <code>index.html</code> file in there, and put the following code in there:
			<pre class="codeblock">
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Made using the MVP engine&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;div&gt;Hello game&lt;/div&gt;
	&lt;script src="/public/js/engine.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
			</pre>
			Pay particular attention to the <code>&lt;script&gt;</code> tag, which is referencing a file in the <code>public</code> directory which does not exist yet.
			This is the bundle file that will be generated by Gulp and Browserfiy, so we don't have to create it now.
		</p>
		<p>
			Finally, the <code>src</code> directory is used to store our game engine JS files. 
			The entry point of the game will be the <code>engine.js</code> file, and it serves a similar role to <code>main()</code> function in C++, Java, and C#.
			We'll create the <code>engine.js</code> file, place it in the <code>src</code> directory, and put the following code there: 
			<code class="codeblock">console.log("hello game");</code>
			The files in this directory will not be served directly by the game server, but will be bundled together using Gulp and Browserify.
			The resulting bundle file will be placed in the <code>public</code> directory, and will contain the entire game in a single file.
		</p>
		<h4>Running Gulp and building our game</h4>
		<p>
			Gulp is used to run various maintenance tasks in a project, and in our case we'll use it to bundle our game engine into a single file.
			The tasks are defined in a file called <code>gulpfile.js</code>, so let's create it and place it in the root directory of our project.
			Let's place the following code in there:
			<pre class="codeblock">
const gulp = require('gulp');
const browserify = require('browserify');
const buffer = require('vinyl-buffer');
const source = require('vinyl-source-stream');

function bundle() {
	return browserify({entries:`src/engine.js`})
		.bundle()
		.pipe(source("engine.js"))
		.pipe(buffer())
		.pipe(gulp.dest(`public/js`));
}

function watch() {
	return gulp.watch("src/**/*.js", gulp.series("default"));
}

gulp.task("default", bundle);
gulp.task("watch", watch);</pre>
		</p>
		<p>
			There are two tasks in the gulpfile, <code>default</code> and <code>watch</code>.
		</p>
		<p>
			The <code>default</code> task runs Browserify on the <code>src/engine.js</code> file, bundles any other files used by it (none at the moment), and places the resulting file in the <code>public/js/engine.js</code> file.
		</p>
		<p>
			The <code>watch</code> task keeps track of the JS files inside the <code>src</code> directory, then runs the <code>default</code> task if it detects any changes.
			It's very handy since we don't have to run Gulp every time we want to make a bundle, but the bundle will be made on any change of the code.
		</p>
		<p>
			Let's try to make a bundle right now. To run the <code>default</code> task, type the following command in the terminal:
			<code class="codeblock">gulp</code>
			The output should look something like this:
			<img class="screenshot" src="img/gulp.png"/>
			Notice the new file in the <code>public/js</code> directory. This file is the bundled engine, and it was created by Gulp and Browserify.
		</p>
		<p>
			We have everything we need to test our development pipeline. Go ahead and run the web server using the following command:
			<code class="codeblock">node app/index.js</code>
			Then, navigate to <code>http://localhost:8080</code> using your browser, and open the development console.
			If everything worked correctly, you should see this message there:
			<img class="screenshot" src="img/console.png"/>
		</p>
		<h4>The main loop</h4>
	</article>
	<script src="js/engine.js"></script>
</body>
</html>